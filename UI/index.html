<!DOCTYPE html>
<head>
	<title>NYC TLC</title>
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="css/leaflet.awesome-markers.css"/>
   <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
   <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
   <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script> -->
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200&family=Roboto:wght@100;300&display=swap" rel="stylesheet">

   <script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
   <script src="js/leaflet.awesome-markers.js"></script>
   <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>   -->
   <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
   
   <script>
	   var markers=[];
var addresses=[];

	   function predict(){
	var src=markers[0]._latlng;
	var dest=markers[1]._latlng;
	var time = $("#datetimepicker").val();
	console.log(time);
	request_body={from: src.lat+","+src.lng, to: dest.lat+","+dest.lng, time: time};
	console.log({from: src.lat+","+src.lng, to: dest.lat+","+dest.lng, time: time})
	$.LoadingOverlay("show");
	$.ajax({
	url:'http://localhost:8081/compute',
	type:"POST",
	data:JSON.stringify(request_body),
	contentType:"application/json; charset=utf-8",
	dataType:"json",
	}).done(function (response) {
			//Do something on success response...
			prediction = response['prediction'];
			$("#ensemble-prediction").html('Predicted Fare: $'+prediction);
			$("#ensemble-src").html($("#src").val());
			$("#ensemble-dest").html($("#dest").val());
			$("#ensemble-time").html($("#datetimepicker").val())
			console.log(prediction)
			$.LoadingOverlay("hide");
		});


	// $.post(url='http://localhost:8081/compute',data=JSON.stringify(request_body),headers={'Content-Type':'application/json'},function(data1){
		
	// });
// 	setTimeout(function(){
//     $.LoadingOverlay("hide");
// }, 3000);
}
   </script>
<style>
body{
	font-size: 20px;
font-family: 'Oswald';
}
.container{
	padding: 0px;
	margin-top: 10px;
	margin-left: 10px;
	margin-right: 10px;
}
</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<h1 style="width:100%; text-align:center; background-color:#153e67; color:#8db600">NYC TLC</h1>
			<!-- <img src="NYCCabs.jpeg"/> -->
		</div>
		<div class="row">
			<div class="col-7" style="width:fit-content">
				<div id="map" style="min-width: 660px; min-height: 500px; position: relative;"></div>
				<div class="row">
					<div class="col-2">Source:</div>
					<div class="col-10"><input id="src" type="text" readonly placeholder="Source" style="width:100%; color: #cc2c45;"/></div>
				</div>
				<div class="row">
					<div class="col-2">Destination:</div>
					<div class="col-10">
						<input id="dest" type="text" readonly placeholder="Destination" style="width:100%; color: #8db600;"/>
					</div>
				</div>
				<div class="row">
					<div class="col-2">Time:</div>
					<div class="col-10">
						<input id="datetimepicker" type="text" style="color:lightslategray;" >
					</div>
				</div>
				<br>
				<div class="row">
					<div class="col-1"></div>
					<div class="col-2">
						<button style=" width: 100%" class="btn btn-danger">CLEAR</button>
					</div>
					<div class="col-9">
					<button style=" width: 100%" onclick="predict()" class="btn btn-primary"><span >PREDICT</span></button>
					
					</div>
					<br><br>
				</div>
				
			</div>
			<div class="col-5">
				<div class="row">
					<div class="d-flex">
						<div class="form-check form-switch ms-auto mt-3 me-3">
						  <label class="form-check-label ms-3" for="lightSwitch">
							<svg
							  xmlns="http://www.w3.org/2000/svg"
							  width="25"
							  height="25"
							  fill="currentColor"
							  class="bi bi-brightness-high"
							  viewBox="0 0 16 16"
							>
							  <path
								d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"
							  />
							</svg>
						  </label>
						  <input class="form-check-input" type="checkbox" id="lightSwitch" />
						</div>
					  </div>
					<h2>New York Taxi Fare Prediction</h2>
					<p>
NYC Taxi is one of the cab services in New York, which is growing rapidly online car rental and taxi hire
companies in New York. To keep up the pace at which they are growing they have decided to optimize
their pricing to gain a good customer base and stay competitive.
					</p>
					<ul class="nav nav-tabs ">
					  <li class="active"><a data-toggle="tab" href="#home">Usage</a>
					  </li>
					  <li><a data-toggle="tab" href="#menu1">Model 1</a>
					  </li>
					  <li><a data-toggle="tab" href="#menu2">Model 2</a>
					  </li>
					  <li><a data-toggle="tab" href="#menu3">Model 3</a>
					  </li>
					</ul>
				
					<div class="tab-content">
					  <div id="home" class="tab-pane fade in active">
						<h3>Usage</h3>
						<span><img src="css/images/marker-icon-red.png"/>Source</span>
						<span><img src="css/images/marker-icon-green.png"/>Destination</span>
						<p>Click on the map at a given location.<br>
							First click marks the Source location, the next click marks the Destination.<br>
							Further clicks deletes the previous source, assigns new point as Destination.
						</p>
					  </div>
					  <div id="menu1" class="tab-pane fade">
						<h3>Decision Tree</h3><hr>
						<p>Incident 1</p>
					  </div>
					  <div id="menu2" class="tab-pane fade">
						<h3>Multilayer Perceptron</h3><hr>
						<p>Incident 2</p>
					  </div>
					  <div id="menu3" class="tab-pane fade">
						<h3>Ensemble</h3><hr>
						
						<div id="ensemble-details">
							Source:<h4 id="ensemble-src"></h4>
							Destination:<h4 id="ensemble-dest"></h4>
							Time:<h4 id="ensemble-time"></h4>
							<h3 id="ensemble-prediction" >Predicted Fare: $</h3>
						</div>
						<p>Incident 3</p>
					  </div>
					</div>
				  </div>
			</div>
			
				<!--  -->
			
		</div>
		<div class="row" style="background-color: #153e67; color:white">
			<div class="col-sm-3">
				<div class="row>">
					<div class="col-sm-1">Team Lead</div>
					<div>
						<figure style="text-align:center">
							<img src="css/images/profile.jpg" style="width: 40%"  />
							<figcaption>Ms Akarsha Sehwag</figcaption>
						</figure>
						
						
					</div>
				</div>
			</div>
			<div class="col-sm-3">
				<div class="row>">
					<div class="col-sm-1">Team Member</div>
					<div>
						<figure style="text-align:center">
							<img src="css/images/profile.jpg" style="width: 40%"  />
							<figcaption>Mr Harsha.M.S</figcaption>
						</figure>
					</div>
				</div>
			</div>
			<div class="col-sm-3">
				<div class="row>">
					<div class="col-sm-1">Team Member</div>
					<div>
						<figure style="text-align:center">
							<img src="css/images/profile.jpg" style="width: 40%"  />
							<figcaption>Ms Kriti Bhardwaj</figcaption>
						</figure>
					</div>
				</div>
			</div>
			<div class="col-sm-3">
				<div class="row>">
					<div class="col-sm-1">Team Member</div>
					<div>
						<figure style="text-align:center">
							<img src="css/images/profile.jpg" style="width: 40%"  />
							<figcaption>Ms Kajal Sharma</figcaption>
						</figure>
					</div>
				</div>
			</div>
		</div>
		<div class="row" style="background-color: #153e67">
			<br><hr>
			<div class="col-sm-3">
				<a href="https://choosealicense.com/licenses/gpl-3.0/#" style="color: white" target="_blank">
					<img src="css/images/LICENSE.png" style="width:10%"/>Shared under GNU GPL3 License
				</a>
			</div>
			<div class="col-sm-3">
				<a href="https://github.com/TeamEpicProjects/Taxi_Fare_Prediction" style="color: white" target="_blank">
					<img src="css/images/github.png" style="width:12%"/> Github Repository
				</a>
			</div>
			<div class="col-sm-4">
				<span style="color: white">Hosted on <img src="css/images/heroku.png" style="width: 20%; filter: invert(68%) sepia(13%) saturate(3207%) hue-rotate(130deg) brightness(95%) contrast(80%);"/></span>
			</div>
			<div class="col-sm-2"><img src="css/images/packt.png" style="width:30%"/></div>
		</div>
	</div>

	<link rel="stylesheet" type="text/css" href="js/datetimepicker/jquery.datetimepicker.css" />
	<script src="js/datetimepicker/jquery.js"></script>
	<script src="js/datetimepicker/php-date-formatter.js"></script>
	<script src="js/datetimepicker/jquery.datetimepicker.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
	<script src="js/switch.js"></script>
<script>


var map = L.map('map').setView([40.72,-73.93], 11);
$("#map").css({"width":"fit-content", "height":"fit-content"});
$(document).ready(function(){
	
	$.LoadingOverlay("show");
	setTimeout(function(){
    	$.LoadingOverlay("hide");
	}, 1000);
	var green=false;

// $('#datetimepicker1').datetimepicker();
// $('#datetimepicker').datetimepicker();
// $.datetimepicker.setDateFormatter({
//     parseDate: function (date, format) {
//         var d = moment(date, format);
//         return d.isValid() ? d.toDate() : false;
//     },
//     formatDate: function (date, format) {
//         return moment(date).format(format);
//     },
// });
$.datetimepicker.setLocale('en');
$('#datetimepicker').datetimepicker({
startDate:	'2020/01/01'
});
// var markers=[];
// var addresses=[];
L.tileLayer('http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.jpg', {
    maxZoom: 18,
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'
}).addTo(map);
var redMarker=L.AwesomeMarkers.icon({
	icon: 'coffee',
	markerColor: 'red'
});



function newMarker(e){
    var new_mark = L.marker().setLatLng(e.latlng).addTo(map);
    //new_mark.dragging.enable();
    new_mark.on('dblclick', function(e){map.removeLayer(e.target);
	if(markers.length == 0){
		addresses=[];
		$("#src").val("");
		$("#dest").val("");
	}
	if(markers.length == 1){
		console.log(e.target);
		var index=markers.indexOf(e.target);
		markers.splice(index,1);
		console.log(index);
		//addresses.shift();
		//$("#src").val(addresses[0]);
		//$("#dest").val("");
	}
    })
    var lat = e.latlng.lat.toFixed(4),
       lng = e.latlng.lng.toFixed(4);
    var address="";
    //$.ajaxSetup({async:false});
	
    $.get('http://localhost:8081/geocode?reverse=true&lat='+lat+'&lng='+lng,function(data){
	details=data
	//new_mark.bindPopup("<h2>Source "+lat+" , "+lng+":"+details.name+"</h2>");
	address=details.name+", "+details.city+", "+details.state+", "+details.country;
	addresses.push(address);
	new_mark.bindPopup("<div style=\"background-color: #def787\"; padding:0>"
	+"<h3 style=\"width: 100%; text-align:center; background-color: #8db600\">Details</h3>"
	+"<h4>Address:<br> "+details.name+",<br>  "+details.city+",<br>  "+details.state+",<br>  "+details.country+"-"+details.postcode+"</h4>"
	+"<h4>Coordinates: "+lat+","+lng+"</h4>"
	+"</div>");
 	$("#src").val(addresses[0]);
	markers[0]._icon.src="css/images/marker-icon-red.png";
 	 if(addresses.length==2){
		$("#dest").val(addresses[1]);
		markers[1]._icon.src="css/images/marker-icon-green.png";
	  }
    });
    //$.ajaxSetup({async:True});
   console.log(lat," ",lng);
var img='marker-icon-red.png';
   if(markers.length ==1)
   	img = "marker-icon-green.png";
   new_mark._icon.src='css/images/'+img;
   new_mark.options.title="Test";
   console.log( new_mark)
   markers.push(new_mark);
   console.log(markers);
   if(markers.length > 2){
     marker = markers.shift();
	 console.log('Previous'+marker._icon.src);
     addr = addresses.shift();
     map.removeLayer(marker);
	 markers[0]._icon.src="css/images/marker-icon-red.png";
	 green = true;
     console.log("After removal:"+markers); 
  }
  
};
map.on('click', newMarker)

});
</script>

</body>
